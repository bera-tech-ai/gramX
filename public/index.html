<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>gramX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0088cc;
            height: 100vh;
            overscroll-behavior: none;
        }

.theme-light { --bg-color: #ffffff; --text-color: #000000; --secondary-bg: #f0f2f5; --border-color: #e0e0e0; }

.theme-dark { --bg-color: #1a1a1a; --text-color: #ffffff; --secondary-bg: #2d2d2d; --border-color: #404040; }

body { background-color: var(--bg-color); color: var(--text-color); }

.auth-container { background: var(--bg-color); }

.auth-input { background: var(--secondary-bg); border-color: var(--border-color); color: var(--text-color); }

.conversations-list, .users-list { background: var(--bg-color); }

.conversation-item, .user-item { border-bottom-color: var(--border-color); }

.conversation-item:hover, .user-item:hover { background: var(--secondary-bg); }

.message-input-container { background: var(--secondary-bg); border-top-color: var(--border-color); }

.message-input { background: var(--bg-color); color: var(--text-color); }

.settings-list { background: var(--bg-color); }

.settings-item { border-bottom-color: var(--border-color); }

.settings-item:active { background: var(--secondary-bg); }

</head>
<body>
    <!-- Connection Status Bar -->
    <div id="connection-status-bar" class="connection-status-bar">
        <span id="connection-status-text">Connecting...</span>
    </div>

<div id="settings-screen" class="screen">
    <div class="settings-header">
        <button class="back-button" onclick="backToChatList()">‚Üê</button>
        <span>Settings</span>
        <div style="width: 48px;"></div>
    </div>

</div>
    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
        <div class="settings-header">
            <button class="back-button" onclick="backToChatList()">‚Üê</button>
            <span>Settings</span>
            <div style="width: 48px;"></div>
        </div>

// ==================== CONFIGURATION & INITIALIZATION ==================== let socket= null; let currentUser= null; let currentTargetUser= null; let onlineUsers= []; let userConversations= []; let isTyping= false; let typingTimeout= null; let selectedMessage= null;

// Local Database for offline support class LocalDB{ constructor() { this.dbName = 'GramXDB'; this.version = 2; this.db = null; }

}

const localDB = new LocalDB();

// Offline Manager class OfflineManager{ constructor() { this.isOnline = navigator.onLine; this.outbox = []; this.init(); }

}

const offlineManager = new OfflineManager();

// ==================== UI FUNCTIONS ==================== function showScreen(screenId){ document.querySelectorAll('.screen').forEach(screen => { screen.classList.remove('active'); }); document.getElementById(screenId).classList.add('active'); }

function showTab(tabName) { document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active')); document.querySelector(.tab:nth-child(${tabName === 'conversations' ? 1 : 2})).classList.add('active');

}

function showOnlineUsers() { showTab('online'); }

function openSettings() { showScreen('settings-screen'); }

function openSearch() { const searchContainer = document.getElementById('search-container'); searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';

}

function toggleEmojiPicker() { const picker = document.getElementById('emoji-picker'); picker.style.display = picker.style.display === 'none' ? 'block' : 'none';

}

function populateEmojiPicker() { const emojiGrid = document.getElementById('emoji-grid'); const emojis = ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü´£', 'ü§ó', 'ü´°', 'ü§î', 'ü´¢', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'ü´†', 'üòê', 'ü´§', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü´•', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†', 'üòà', 'üëø', 'üëπ', 'üë∫', 'ü§°', 'üí©', 'üëª', 'üíÄ', '‚ò†Ô∏è', 'üëΩ', 'üëæ', 'ü§ñ', 'üéÉ', 'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'];

}

function showContextMenu(e, message) { selectedMessage = message; const menu = document.getElementById('context-menu'); menu.style.display = 'block'; menu.style.left = e.pageX + 'px'; menu.style.top = e.pageY + 'px';

}

function hideContextMenu() { const menu = document.getElementById('context-menu'); menu.style.display = 'none'; document.removeEventListener('click', hideContextMenu); }

function copyMessage() { if (selectedMessage) { navigator.clipboard.writeText(selectedMessage.text); hideContextMenu(); } }

function deleteMessage() { if (selectedMessage) { // Implement message deletion logic console.log('Delete message:', selectedMessage); hideContextMenu(); } }

function showChatOptions(e) { // Implement chat options menu alert('Chat options menu would appear here'); }

// ==================== AUTHENTICATION ==================== async function register(){ const username = document.getElementById('register-username').value; const password = document.getElementById('register-password').value;

}

async function login() { const username = document.getElementById('login-username').value; const password = document.getElementById('login-password').value;

}

// ==================== SOCKET.IO & MESSAGING ==================== function initializeSocket(){ socket = io();

}

async function loadLocalConversations() { try { const conversations = await localDB.getConversations(); if (conversations.length > 0) { userConversations = conversations; updateConversationsList(); } } catch (error) { console.error('Error loading local conversations:', error); } }

function updateConversationsList() { const container = document.getElementById('conversations-tab'); const emptyState = document.getElementById('no-conversations');

}

function updateOnlineUsersList() { const container = document.getElementById('online-tab'); const emptyState = document.getElementById('no-online-users');

}

async function startPrivateChat(targetUser) { currentTargetUser = targetUser; document.getElementById('chat-target-name').textContent = targetUser;

}

function getConversationId(user1, user2) { return [user1, user2].sort().join('_'); }

function displayMessages(messages) { const container = document.getElementById('private-messages-container'); container.innerHTML = '';

}

function addPrivateMessageToChat(message) { const container = document.getElementById('private-messages-container'); const messageDiv = offlineManager.createMessageElement(message); container.appendChild(messageDiv); container.scrollTop = container.scrollHeight; }

function updateMessageStatus(messageId, status) { const messages = document.querySelectorAll('.message'); messages.forEach(msg => { if (msg.dataset.messageId === messageId) { const statusElement = msg.querySelector('.message-status-indicator'); if (statusElement) { statusElement.textContent = status === 'read' ? '‚úì‚úì' : '‚úì'; } } }); }

function showTypingIndicator() { const indicator = document.getElementById('typing-indicator'); indicator.style.display = 'block'; }

function hideTypingIndicator() { const indicator = document.getElementById('typing-indicator'); indicator.style.display = 'none'; }

function handleMessageInput() { const input = document.getElementById('private-message-input');

}

async function sendPrivateMessage() { const input = document.getElementById('private-message-input'); const text = input.value.trim();

}

function handlePrivateKeyPress(event) { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendPrivateMessage(); } }

function backToChatList() { showScreen('chat-list-screen'); // Refresh conversations if (socket && offlineManager.isOnline) { socket.emit('user-login', currentUser); } } //==================== SETTINGS FUNCTIONS ==================== async function openSettings(){ try { // Load user settings from server const response = await fetch(/user-settings/${currentUser}); const result = await response.json();

}

function updateSettingsUI(settings) { // This function would update the settings UI based on the current settings // For now, we'll just store the settings globally window.userSettings = settings; }

async function changeUsername() { const newUsername = prompt('Enter new username:'); if (newUsername && newUsername !== currentUser) { try { // In a real app, you'd have a proper API endpoint for username changes const response = await fetch('/change-username', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({  currentUsername: currentUser,  newUsername  }) });

}

async function changeNotifications() { const newSetting = !window.userSettings.notifications;

}

async function changePrivacy() { const privacyOptions = [
        { value: 'everyone', label: 'Everyone' },
        { value: 'contacts', label: 'My Contacts' },
        { value: 'nobody', label: 'Nobody' }
    ];

}

async function changeTheme() { const themes = ['light', 'dark', 'system']; const currentTheme = window.userSettings.theme || 'light';

}

function applyTheme(theme) { // Remove existing theme classes document.body.classList.remove('theme-light', 'theme-dark');

}

async function showStorage() { try { // Calculate storage usage const estimate = await navigator.storage.estimate(); const usageMB = (estimate.usage / (1024 * 1024)).toFixed(2); const quotaMB = (estimate.quota / (1024 * 1024)).toFixed(2);

}

async function manageBlockedUsers() { try { const response = await fetch(/blocked-users/${currentUser}); const result = await response.json();

}

async function blockUser() { const userToBlock = prompt('Enter username to block:'); if (userToBlock && userToBlock !== currentUser) { try { // Check if user exists const userCheck = await fetch(/check-user/${userToBlock}); const userResult = await userCheck.json();

}

// Add these missing server endpoints to your server.js //Add this to your server.js after the existing routes:

// Check if user exists app.get('/check-user/:username',async (req, res) => { try { const { username } = req.params; const user = await db.collection(COLLECTIONS.USERS).findOne({ username }); res.json({ exists: !!user }); } catch (error) { res.status(500).json({ exists: false }); } });

// Change username endpoint app.post('/change-username',async (req, res) => { try { const { currentUsername, newUsername } = req.body;

});

// Also update your settings item click handlers: function setupSettingsHandlers(){ // Replace the existing settings item functions with these: const settingsItems = { 'changeUsername': changeUsername, 'changeNotifications': changeNotifications, 'changePrivacy': changePrivacy, 'changeTheme': changeTheme, 'showStorage': showStorage, 'manageBlockedUsers': manageBlockedUsers, 'blockUser': blockUser, 'logout': logout };

}

// Initialize settings when page loads document.addEventListener('DOMContentLoaded',function() { // Load saved theme const savedTheme = localStorage.getItem('gramX-theme') || 'light'; applyTheme(savedTheme);

});

// Update your settings HTML to use these functions: //Replace the settings section in your HTML with this:

// ==================== SETTINGS FUNCTIONS ==================== function changeUsername(){ const newUsername = prompt('Enter new username:'); if (newUsername) { alert('Username change functionality would be implemented here'); } }

function changeNotifications() { alert('Notification settings would appear here'); }

function changePrivacy() { alert('Privacy settings would appear here'); }

function changeTheme() { alert('Theme selection would appear here'); }

function showStorage() { alert('Storage management would appear here'); }

function logout() { currentUser = null; currentTargetUser = null; onlineUsers = []; userConversations = [];

}

// ==================== INITIALIZATION ==================== async function init(){ try { // Initialize local database await localDB.init();

}

// Start initialization when page loads window.onload= init;

// Pre-fill for testing document.getElementById('login-username').value= 'user1'; document.getElementById('login-password').value= 'pass';

</body>
</html>
