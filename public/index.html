<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>gramX</title>
    <style>
        /* Add these new styles for enhanced settings */
        
        /* Advanced Settings Modal */
        .settings-container {
            padding: 0;
        }
        
        .settings-section {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .settings-section-title {
            font-weight: 600;
            color: #0088cc;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .settings-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
        }
        
        .settings-item:not(:last-child) {
            border-bottom: 1px solid #f0f0f0;
        }
        
        .settings-item-content {
            flex: 1;
        }
        
        .settings-item-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .settings-item-description {
            font-size: 12px;
            color: #666;
        }
        
        .settings-item-action {
            color: #0088cc;
            font-size: 14px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #0088cc;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Developer Info Section */
        .developer-info {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .developer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 15px;
        }
        
        .developer-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .developer-contact {
            color: #0088cc;
            text-decoration: none;
            font-size: 14px;
        }
        
        .developer-contact:hover {
            text-decoration: underline;
        }
        
        /* Theme Options */
        .theme-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .theme-option {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .theme-option.active {
            border-color: #0088cc;
        }
        
        .theme-light {
            background: #ffffff;
            border: 1px solid #e0e0e0;
        }
        
        .theme-dark {
            background: #1a1a1a;
            border: 1px solid #333;
        }
        
        .theme-system {
            background: linear-gradient(135deg, #ffffff 50%, #1a1a1a 50%);
            border: 1px solid #e0e0e0;
        }
        
        /* Edit Profile Modal */
        .edit-profile-form {
            padding: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
    </style>
</head>
<body>
    <!-- Add these new modals to your HTML -->

    <!-- Advanced Settings Modal -->
    <div id="advanced-settings-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Settings & Preferences</h3>
            </div>
            
            <div class="settings-container">
                <!-- Appearance Section -->
                <div class="settings-section">
                    <div class="settings-section-title">Appearance</div>
                    
                    <div class="settings-item">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Theme</div>
                            <div class="settings-item-description">Choose your preferred theme</div>
                        </div>
                        <div class="settings-item-action" onclick="showThemeSelector()">Change</div>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Font Size</div>
                            <div class="settings-item-description">Adjust text size</div>
                        </div>
                        <div class="settings-item-action">Medium</div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div class="settings-section">
                    <div class="settings-section-title">Notifications</div>
                    
                    <div class="settings-item">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Message Notifications</div>
                            <div class="settings-item-description">Enable message alerts</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="notification-toggle" checked onchange="toggleNotifications()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Sound</div>
                            <div class="settings-item-description">Play sound for new messages</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="sound-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Privacy Section -->
                <div class="settings-section">
                    <div class="settings-section-title">Privacy & Security</div>
                    
                    <div class="settings-item" onclick="showPrivacySettings()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Privacy Settings</div>
                            <div class="settings-item-description">Manage your privacy options</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                    
                    <div class="settings-item" onclick="showSecuritySettings()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Security</div>
                            <div class="settings-item-description">Two-factor authentication</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                </div>

                <!-- Account Section -->
                <div class="settings-section">
                    <div class="settings-section-title">Account</div>
                    
                    <div class="settings-item" onclick="editProfile()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Edit Profile</div>
                            <div class="settings-item-description">Update your information</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                    
                    <div class="settings-item" onclick="changePassword()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Change Password</div>
                            <div class="settings-item-description">Update your password</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                </div>

                <!-- Developer Information -->
                <div class="settings-section">
                    <div class="settings-section-title">About & Support</div>
                    
                    <div class="developer-info">
                        <div class="developer-avatar">B</div>
                        <div class="developer-name">Bruce Bera</div>
                        <div class="developer-contact">
                            <a href="tel:+254743982206" style="color: #0088cc; text-decoration: none;">
                                ðŸ“ž +254 743 982 206
                            </a>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            Full Stack Developer
                        </div>
                    </div>
                    
                    <div class="settings-item" onclick="showAppInfo()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">App Information</div>
                            <div class="settings-item-description">Version and details</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                    
                    <div class="settings-item" onclick="contactSupport()">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Contact Support</div>
                            <div class="settings-item-description">Get help with gramX</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="settings-section">
                    <div class="settings-section-title" style="color: #ff4757;">Danger Zone</div>
                    
                    <div class="settings-item" onclick="logout()" style="color: #ff4757;">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Logout</div>
                            <div class="settings-item-description">Sign out of your account</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                    
                    <div class="settings-item" onclick="deleteAccount()" style="color: #ff4757;">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Delete Account</div>
                            <div class="settings-item-description">Permanently remove your account</div>
                        </div>
                        <div class="settings-item-action">â†’</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
            </div>
            
            <div class="edit-profile-form">
                <div class="form-group">
                    <label class="form-label">Profile Picture</label>
                    <div style="text-align: center;">
                        <img id="edit-profile-preview" class="profile-preview" src="">
                        <input type="file" id="edit-profile-upload" accept="image/*" style="display: none;" onchange="previewEditProfileImage(this)">
                        <button onclick="document.getElementById('edit-profile-upload').click()" style="padding: 8px 15px; background: #0088cc; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Change Photo</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="edit-username" class="form-input" placeholder="Username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    <textarea id="edit-bio" class="form-textarea" placeholder="Tell something about yourself"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" id="edit-phone" class="form-input" placeholder="+254 XXX XXX XXX">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="saveProfile()" style="flex: 1; padding: 12px; background: #0088cc; color: white; border: none; border-radius: 8px; cursor: pointer;">Save Changes</button>
                    <button onclick="closeModal('edit-profile-modal')" style="flex: 1; padding: 12px; background: #ccc; color: #333; border: none; border-radius: 8px; cursor: pointer;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div id="theme-selector-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Choose Theme</h3>
            </div>
            
            <div class="settings-container">
                <div class="theme-options">
                    <div class="theme-option theme-light active" onclick="selectTheme('light')"></div>
                    <div class="theme-option theme-dark" onclick="selectTheme('dark')"></div>
                    <div class="theme-option theme-system" onclick="selectTheme('system')"></div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="applyTheme()" style="padding: 12px 30px; background: #0088cc; color: white; border: none; border-radius: 8px; cursor: pointer;">Apply Theme</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Add these new JavaScript functions for enhanced settings

        let appInfo = {
            name: 'gramX',
            version: '1.0.0',
            developer: 'Bruce Bera',
            contact: '+254743982206'
        };

        // Enhanced Settings Functions
        function showAdvancedSettings() {
            loadUserSettings();
            showModal('advanced-settings-modal');
        }

        async function loadUserSettings() {
            try {
                const response = await fetch('/user/profile?userId=' + currentUser.id);
                const result = await response.json();
                
                if (result.success) {
                    // Update toggle switches based on user preferences
                    document.getElementById('notification-toggle').checked = result.user.notificationEnabled;
                    // Load other settings as needed
                }
            } catch (error) {
                console.error('Error loading user settings:', error);
            }
        }

        async function toggleNotifications() {
            const enabled = document.getElementById('notification-toggle').checked;
            
            try {
                const response = await fetch('/user/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser.id,
                        notificationEnabled: enabled
                    })
                });
                
                const result = await response.json();
                if (!result.success) {
                    alert('Failed to update notification settings');
                }
            } catch (error) {
                console.error('Error updating notifications:', error);
            }
        }

        function editProfile() {
            // Load current profile data into edit form
            document.getElementById('edit-username').value = currentUser.username;
            document.getElementById('edit-bio').value = currentUser.bio || '';
            document.getElementById('edit-phone').value = currentUser.phoneNumber || '';
            document.getElementById('edit-profile-preview').src = currentUser.profilePicture || getInitialsAvatar(currentUser.username);
            
            closeModal('advanced-settings-modal');
            showModal('edit-profile-modal');
        }

        async function saveProfile() {
            const formData = new FormData();
            formData.append('userId', currentUser.id);
            formData.append('username', document.getElementById('edit-username').value);
            formData.append('bio', document.getElementById('edit-bio').value);
            formData.append('phoneNumber', document.getElementById('edit-phone').value);
            
            const profileInput = document.getElementById('edit-profile-upload');
            if (profileInput.files[0]) {
                formData.append('profilePicture', profileInput.files[0]);
            }

            try {
                const response = await fetch('/user/profile', {
                    method: 'PUT',
                    body: formData
                });

                const result = await response.json();
                if (result.success) {
                    currentUser = result.user;
                    alert('Profile updated successfully!');
                    closeModal('edit-profile-modal');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Failed to update profile');
            }
        }

        function showThemeSelector() {
            showModal('theme-selector-modal');
        }

        function selectTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`.theme-${theme}`).classList.add('active');
            currentTheme = theme;
        }

        function applyTheme() {
            // Save theme preference and apply it
            localStorage.setItem('gramx-theme', currentTheme);
            document.body.setAttribute('data-theme', currentTheme);
            closeModal('theme-selector-modal');
            alert('Theme applied successfully!');
        }

        function showAppInfo() {
            alert(`App: ${appInfo.name}\nVersion: ${appInfo.version}\nDeveloper: ${appInfo.developer}\nContact: ${appInfo.contact}`);
        }

        function contactSupport() {
            window.open(`https://wa.me/${appInfo.contact.replace(/\D/g, '')}?text=Hello%20Bruce,%20I%20need%20help%20with%20gramX`, '_blank');
        }

        function changePassword() {
            const newPassword = prompt('Enter new password:');
            if (newPassword) {
                alert('Password change functionality will be implemented soon!');
            }
        }

        function showPrivacySettings() {
            alert('Privacy settings will be available in the next update!');
        }

        function showSecuritySettings() {
            alert('Security settings will be available in the next update!');
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                alert('Account deletion functionality will be implemented soon!');
            }
        }

        // Update your existing settings button to use advanced settings
        function showSettings() {
            showAdvancedSettings();
        }

        // Load app info on startup
        async function loadAppInfo() {
            try {
                const response = await fetch('/app/info');
                const result = await response.json();
                if (result.success) {
                    appInfo = result.app;
                }
            } catch (error) {
                console.log('Using default app info');
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            loadAppInfo();
        });
    </script>
</body>
</html>
